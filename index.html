<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Weight Loss">
  <meta name="theme-color" content="#6366f1">
  <meta name="description" content="Track your weight loss journey with daily goals, workouts, meals, and progress tracking">
  
  <title>Weight Loss Journey - David & Amanda</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  
  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" href="/icon-192.png">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React Production -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Recharts -->
  <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <!-- Babel Standalone -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
    }
    
    @media (display-mode: standalone) {
      body {
        padding-top: env(safe-area-inset-top);
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script>
    // Register Service Worker for PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('SW registered:', registration);
          })
          .catch((error) => {
            console.log('SW registration failed:', error);
          });
      });
    }
  </script>

  <script type="text/babel" data-type="module">
    const { useState, useEffect } = React;
    const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, BarChart, Bar, PieChart, Pie, Cell, AreaChart, Area } = Recharts;
    
    // Beach image data (truncated for brevity - use your full base64 string)
    const BEACH_IMAGE = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwMCIgaGVpZ2h0PSI0MDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJza3kiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMCUiIHkyPSIxMDAlIj48c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojODdDRUVCO3N0b3Atb3BhY2l0eToxIiAvPjxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6I0UwRjJGRTtzdG9wLW9wYWNpdHk6MSIgLz48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwMCIgaGVpZ2h0PSI0MDAiIGZpbGw9InVybCgjc2t5KSIvPjxjaXJjbGUgY3g9IjkwMCIgY3k9IjgwIiByPSI2MCIgZmlsbD0iI0ZEQjcxMyIgb3BhY2l0eT0iMC45Ii8+PGVsbGlwc2UgY3g9IjUwMCIgY3k9IjM1MCIgcng9IjYwMCIgcnk9IjEwMCIgZmlsbD0iI0YwRTY4QyIgb3BhY2l0eT0iMC44Ii8+PHBhdGggZD0iTTAgMzAwIFEgMTAwIDI4MCwgMjAwIDMwMCBRIDMwMCAzMjAsIDQwMCAzMDAgUSA1MDAgMjgwLCA2MDAgMzAwIFEgNzAwIDMyMCwgODAwIDMwMCBRIDkwMCAyODAsIDEwMDAgMzAwIEwgMTAwMCA0MDAgTCAwIDQwMCBaIiBmaWxsPSIjMEI3Mjg1IiBvcGFjaXR5PSIwLjciLz48L3N2Zz4=";
    
    // Note: Replace BEACH_IMAGE above with your full base64 beach photo
    
    const WeightLossApp = () => {
      const [activeTab, setActiveTab] = useState('dashboard');
      const [activeUser, setActiveUser] = useState('david');
      const [loading, setLoading] = useState(true);
      
      const [userData, setUserData] = useState({
        david: {
          name: 'David',
          startWeight: 283,
          currentWeight: 283,
          targetWeight: 231,
          finalGoal: 210,
          heightInches: 70,
          calorieTarget: 1700,
          proteinTarget: 180,
          waterTarget: 3000, // ml (3 liters)
          exerciseGoal: 60, // minutes
          photos: [],
          dailyLogs: [],
          workoutsCompleted: []
        },
        amanda: {
          name: 'Amanda',
          startWeight: 0,
          currentWeight: 0,
          targetWeight: 0,
          heightInches: 65,
          calorieTarget: 1500,
          proteinTarget: 120,
          waterTarget: 2500, // ml (2.5 liters)
          exerciseGoal: 45, // minutes
          photos: [],
          dailyLogs: [],
          workoutsCompleted: []
        }
      });

      useEffect(() => {
        loadData();
      }, []);

      const loadData = async () => {
        try {
          if (window.storage) {
            const result = await window.storage.get('weight-loss-data');
            if (result && result.value) {
              setUserData(JSON.parse(result.value));
            }
          }
        } catch (error) {
          console.log('Starting fresh');
        } finally {
          setLoading(false);
        }
      };

      const saveData = async (newData) => {
        setUserData(newData);
        try {
          if (window.storage) {
            await window.storage.set('weight-loss-data', JSON.stringify(newData));
          }
        } catch (error) {
          console.error('Failed to save:', error);
        }
      };

      const currentUser = userData[activeUser];
      const holidayDate = new Date('2026-05-14');
      const startDate = new Date('2026-01-03');
      const today = new Date();
      const daysToHoliday = Math.ceil((holidayDate - today) / (1000 * 60 * 60 * 24));
      const weekNumber = Math.ceil((today - startDate) / (1000 * 60 * 60 * 24 * 7));

      const quotes = [
        "Every workout is progress. Every meal is a choice. Every day is a fresh start.",
        "The only impossible journey is the one you never begin.",
        "Success is the sum of small efforts repeated day in and day out.",
        "Your body can stand almost anything. It's your mind you have to convince.",
        "Don't wish for it. Work for it."
      ];

      const [currentQuote, setCurrentQuote] = useState(quotes[0]);

      useEffect(() => {
        const quoteInterval = setInterval(() => {
          setCurrentQuote(quotes[Math.floor(Math.random() * quotes.length)]);
        }, 30000);
        return () => clearInterval(quoteInterval);
      }, []);

      if (loading) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-800 flex items-center justify-center">
            <div className="text-white text-2xl">Loading...</div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-800">
          {/* Header with beach countdown */}
          <div className="relative backdrop-blur-md bg-white/10 border-b border-white/20 shadow-2xl">
            <div className="max-w-7xl mx-auto px-4 py-4">
              <div className="flex items-center justify-between mb-4">
                <h1 className="text-2xl font-extrabold text-white">Weight Loss Journey</h1>
                <div className="flex gap-3">
                  <button
                    onClick={() => setActiveUser('david')}
                    className={\`px-6 py-2 rounded-xl font-bold transition-all \${activeUser === 'david' ? 'bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg' : 'bg-white/20 text-white'}\`}
                  >
                    David
                  </button>
                  <button
                    onClick={() => setActiveUser('amanda')}
                    className={\`px-6 py-2 rounded-xl font-bold transition-all \${activeUser === 'amanda' ? 'bg-gradient-to-r from-pink-500 to-pink-600 text-white shadow-lg' : 'bg-white/20 text-white'}\`}
                  >
                    Amanda
                  </button>
                </div>
              </div>

              <div className="relative rounded-3xl overflow-hidden shadow-2xl h-64"
                   style={{backgroundImage: \`url(\${BEACH_IMAGE})\`, backgroundSize: 'cover', backgroundPosition: 'center'}}>
                <div className="absolute inset-0 flex items-center justify-center">
                  <div className="text-center">
                    <div className="text-8xl font-extrabold mb-2 text-white drop-shadow-2xl">{daysToHoliday}</div>
                    <p className="text-2xl font-semibold text-white drop-shadow-lg">days until paradise</p>
                    <p className="text-xl text-white mt-2 drop-shadow-lg">May 14th, 2026 üå¥</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* Tabs */}
          <div className="bg-gradient-to-r from-slate-800 via-slate-900 to-slate-800 border-b-2 border-white/20 sticky top-0 z-40">
            <div className="max-w-7xl mx-auto px-4 py-2">
              <div className="flex flex-wrap justify-center gap-2">
                {[
                  { id: 'dashboard', label: 'Dashboard', icon: 'üìä' },
                  { id: 'bmi', label: 'BMI', icon: '‚öñÔ∏è' },
                  { id: 'photos', label: 'Photos', icon: 'üì∏' },
                  { id: 'workouts', label: 'Workouts', icon: 'üí™' },
                  { id: 'meals', label: 'Meals', icon: 'üçΩÔ∏è' },
                  { id: 'checkin', label: 'Check-In', icon: '‚úÖ' },
                  { id: 'progress', label: 'Progress', icon: 'üìà' }
                ].map((tab) => (
                  <button
                    key={tab.id}
                    onClick={() => setActiveTab(tab.id)}
                    className={\`flex items-center gap-2 px-4 py-3 rounded-xl font-bold transition-all \${activeTab === tab.id ? 'bg-gradient-to-br from-purple-600 to-pink-600 text-white shadow-2xl scale-105' : 'bg-white/10 text-white/70 hover:bg-white/20'}\`}
                  >
                    <span className="text-xl">{tab.icon}</span>
                    <span className="text-xs">{tab.label}</span>
                  </button>
                ))}
              </div>
            </div>
          </div>

          {/* Quote */}
          <div className="text-center py-6 px-4">
            <p className="text-white text-xl font-bold italic drop-shadow-lg">"{currentQuote}"</p>
          </div>

          {/* Content */}
          <div className="max-w-7xl mx-auto px-4 py-8">
            {activeTab === 'dashboard' && <Dashboard currentUser={currentUser} weekNumber={weekNumber} />}
            {activeTab === 'checkin' && <CheckIn currentUser={currentUser} saveData={saveData} userData={userData} activeUser={activeUser} />}
            {/* Add other tab components here */}
            {activeTab !== 'dashboard' && activeTab !== 'checkin' && (
              <div className="text-center text-white text-2xl py-20">
                {activeTab.charAt(0).toUpperCase() + activeTab.slice(1)} - Coming soon!
              </div>
            )}
          </div>
        </div>
      );
    };

    // Dashboard Component with Water & Exercise
    const Dashboard = ({ currentUser, weekNumber }) => {
      const recentLogs = currentUser.dailyLogs.slice(-7);
      const todaysLog = recentLogs[recentLogs.length - 1];
      const todayCalories = todaysLog?.calories || 0;
      const todayProtein = todaysLog?.protein || 0;
      const todaySteps = todaysLog?.steps || 0;
      const todayWater = todaysLog?.water || 0;
      const todayExercise = todaysLog?.exercise || 0;
      
      const calorieProgress = (todayCalories / currentUser.calorieTarget) * 100;
      const proteinProgress = (todayProtein / currentUser.proteinTarget) * 100;
      const stepsProgress = (todaySteps / 8000) * 100;
      const waterProgress = (todayWater / currentUser.waterTarget) * 100;
      const exerciseProgress = (todayExercise / currentUser.exerciseGoal) * 100;

      return (
        <div className="space-y-6">
          <h2 className="text-3xl font-extrabold text-white mb-6 text-center">üìä Dashboard</h2>
          
          <div className="bg-white/10 backdrop-blur-md rounded-2xl shadow-2xl p-6 border border-white/20">
            <h3 className="text-2xl font-bold text-white mb-4 text-center">Today's Goals</h3>
            <div className="grid grid-cols-1 gap-4">
              <ProgressRing value={calorieProgress} label="Calories" current={todayCalories} target={currentUser.calorieTarget} icon="üî•" color="orange" />
              <ProgressRing value={proteinProgress} label="Protein" current={\`\${todayProtein}g\`} target={\`\${currentUser.proteinTarget}g\`} icon="üí™" color="blue" />
              <ProgressRing value={waterProgress} label="Water" current={\`\${todayWater}ml\`} target={\`\${currentUser.waterTarget}ml\`} icon="üíß" color="cyan" />
              <ProgressRing value={exerciseProgress} label="Exercise" current={\`\${todayExercise}min\`} target={\`\${currentUser.exerciseGoal}min\`} icon="‚è±Ô∏è" color="purple" />
              <ProgressRing value={stepsProgress} label="Steps" current={todaySteps.toLocaleString()} target="8,000" icon="üëü" color="green" />
            </div>
          </div>

          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            <StatCard emoji="üìä" label="Current" value={lbsToStones(currentUser.currentWeight)} color="from-blue-500 to-cyan-400" />
            <StatCard emoji="üìâ" label="Lost" value={\`\${(currentUser.startWeight - currentUser.currentWeight).toFixed(1)} lbs\`} color="from-purple-500 to-pink-500" />
            <StatCard emoji="üéØ" label="To Goal" value={\`\${(currentUser.currentWeight - currentUser.targetWeight).toFixed(1)} lbs\`} color="from-green-500 to-emerald-500" />
            <StatCard emoji="üìÖ" label="Week" value={\`\${weekNumber}/19\`} color="from-orange-500 to-red-500" />
          </div>
        </div>
      );
    };

    const ProgressRing = ({ value, label, current, target, icon, color }) => {
      const circumference = 2 * Math.PI * 60;
      const offset = circumference * (1 - Math.min(value, 100) / 100);
      const colors = {
        orange: { start: '#f97316', end: '#ef4444', bg: 'from-orange-500/20 to-red-500/20' },
        blue: { start: '#3b82f6', end: '#8b5cf6', bg: 'from-blue-500/20 to-purple-500/20' },
        green: { start: '#10b981', end: '#06b6d4', bg: 'from-green-500/20 to-cyan-500/20' },
        cyan: { start: '#06b6d4', end: '#0ea5e9', bg: 'from-cyan-500/20 to-blue-500/20' },
        purple: { start: '#a855f7', end: '#ec4899', bg: 'from-purple-500/20 to-pink-500/20' }
      };

      return (
        <div className={\`bg-gradient-to-br \${colors[color].bg} backdrop-blur-sm rounded-2xl p-4 border border-white/20 shadow-xl\`}>
          <div className="flex items-center justify-center gap-4">
            <div className="relative flex-shrink-0">
              <svg className="transform -rotate-90" width="80" height="80">
                <circle cx="40" cy="40" r="32" fill="none" stroke="rgba(255,255,255,0.15)" strokeWidth="8" />
                <circle 
                  cx="40" cy="40" r="32" fill="none" 
                  stroke={\`url(#gradient-\${color})\`}
                  strokeWidth="8"
                  strokeDasharray={circumference}
                  strokeDashoffset={offset}
                  strokeLinecap="round"
                />
                <defs>
                  <linearGradient id={\`gradient-\${color}\`} x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stopColor={colors[color].start} />
                    <stop offset="100%" stopColor={colors[color].end} />
                  </linearGradient>
                </defs>
              </svg>
              <div className="absolute inset-0 flex items-center justify-center">
                <span className="text-xl font-extrabold text-white">{Math.min(value, 100).toFixed(0)}%</span>
              </div>
            </div>
            
            <div className="flex-1 min-w-0">
              <div className="flex items-center justify-center gap-2 mb-1">
                <span className="text-2xl">{icon}</span>
                <h4 className="text-white font-bold text-lg">{label}</h4>
              </div>
              <div className="flex items-baseline justify-center gap-1">
                <span className="text-2xl font-extrabold text-white">{current}</span>
                <span className="text-white/60 text-sm">/ {target}</span>
              </div>
            </div>
          </div>
        </div>
      );
    };

    const StatCard = ({ emoji, label, value, color }) => (
      <div className={\`bg-gradient-to-br \${color} rounded-2xl shadow-2xl p-6 text-white text-center\`}>
        <div className="text-3xl mb-2">{emoji}</div>
        <p className="text-sm opacity-90">{label}</p>
        <p className="text-3xl font-extrabold">{value}</p>
      </div>
    );

    const lbsToStones = (lbs) => {
      const stones = Math.floor(lbs / 14);
      const pounds = Math.round(lbs % 14);
      return \`\${stones}st \${pounds}lb\`;
    };

    // Check-In Component with Water & Exercise
    const CheckIn = ({ currentUser, saveData, userData, activeUser }) => {
      const [weight, setWeight] = useState('');
      const [calories, setCalories] = useState('');
      const [protein, setProtein] = useState('');
      const [steps, setSteps] = useState('');
      const [water, setWater] = useState('');
      const [exercise, setExercise] = useState('');
      const [jointHealth, setJointHealth] = useState(5);
      const [workoutDone, setWorkoutDone] = useState(false);
      const [notes, setNotes] = useState('');

      const handleSubmit = () => {
        const newData = { ...userData };
        if (weight) newData[activeUser].currentWeight = parseFloat(weight);
        
        newData[activeUser].dailyLogs.push({
          date: new Date().toISOString().split('T')[0],
          type: 'checkin',
          weight: parseFloat(weight) || currentUser.currentWeight,
          calories: parseFloat(calories) || 0,
          protein: parseFloat(protein) || 0,
          steps: parseInt(steps) || 0,
          water: parseInt(water) || 0,
          exercise: parseInt(exercise) || 0,
          jointHealth,
          workoutDone,
          notes
        });
        
        saveData(newData);
        
        // Reset form
        setWeight('');
        setCalories('');
        setProtein('');
        setSteps('');
        setWater('');
        setExercise('');
        setJointHealth(5);
        setWorkoutDone(false);
        setNotes('');
        
        alert('‚úÖ Check-in saved! Amazing work today! üéâ');
      };

      return (
        <div className="space-y-6 max-w-3xl mx-auto">
          <h2 className="text-3xl font-extrabold text-white mb-6 text-center">‚úÖ Daily Check-In</h2>
          
          <div className="bg-white/10 backdrop-blur-md rounded-2xl shadow-2xl p-8 border border-white/20">
            <div className="space-y-6">
              <div className="bg-white/10 rounded-xl p-6">
                <label className="block text-lg font-bold text-white mb-3">‚öñÔ∏è Weight (lbs)</label>
                <input type="number" step="0.1" value={weight} onChange={(e) => setWeight(e.target.value)}
                  className="w-full px-6 py-4 bg-white/90 rounded-xl text-gray-900 font-bold text-xl"
                  placeholder="Today's weight" />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div className="bg-white/10 rounded-xl p-6">
                  <label className="block text-lg font-bold text-white mb-3">üî• Calories</label>
                  <input type="number" value={calories} onChange={(e) => setCalories(e.target.value)}
                    className="w-full px-6 py-4 bg-white/90 rounded-xl text-gray-900 font-bold text-xl" />
                </div>
                <div className="bg-white/10 rounded-xl p-6">
                  <label className="block text-lg font-bold text-white mb-3">üí™ Protein (g)</label>
                  <input type="number" value={protein} onChange={(e) => setProtein(e.target.value)}
                    className="w-full px-6 py-4 bg-white/90 rounded-xl text-gray-900 font-bold text-xl" />
                </div>
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div className="bg-white/10 rounded-xl p-6">
                  <label className="block text-lg font-bold text-white mb-3">üíß Water (ml)</label>
                  <input type="number" value={water} onChange={(e) => setWater(e.target.value)}
                    className="w-full px-6 py-4 bg-white/90 rounded-xl text-gray-900 font-bold text-xl"
                    placeholder={\`Target: \${currentUser.waterTarget}ml\`} />
                </div>
                <div className="bg-white/10 rounded-xl p-6">
                  <label className="block text-lg font-bold text-white mb-3">‚è±Ô∏è Exercise (min)</label>
                  <input type="number" value={exercise} onChange={(e) => setExercise(e.target.value)}
                    className="w-full px-6 py-4 bg-white/90 rounded-xl text-gray-900 font-bold text-xl"
                    placeholder={\`Target: \${currentUser.exerciseGoal}min\`} />
                </div>
              </div>

              <div className="bg-white/10 rounded-xl p-6">
                <label className="block text-lg font-bold text-white mb-3">üëü Steps</label>
                <input type="number" value={steps} onChange={(e) => setSteps(e.target.value)}
                  className="w-full px-6 py-4 bg-white/90 rounded-xl text-gray-900 font-bold text-xl" />
              </div>

              <div className="bg-white/10 rounded-xl p-6">
                <label className="flex items-center gap-3 cursor-pointer">
                  <input type="checkbox" checked={workoutDone} onChange={(e) => setWorkoutDone(e.target.checked)}
                    className="w-6 h-6 text-purple-600 rounded" />
                  <span className="text-lg font-bold text-white">‚úÖ Completed today's workout</span>
                </label>
              </div>

              <div className="bg-white/10 rounded-xl p-6">
                <label className="block text-lg font-bold text-white mb-4">ü¶µ Joint Health (1-10)</label>
                <div className="flex items-center gap-6">
                  <input type="range" min="1" max="10" value={jointHealth} onChange={(e) => setJointHealth(parseInt(e.target.value))}
                    className="flex-1 h-3" />
                  <span className="text-4xl font-extrabold text-white w-16 text-center bg-white/20 rounded-xl p-2">{jointHealth}</span>
                </div>
              </div>

              <div className="bg-white/10 rounded-xl p-6">
                <label className="block text-lg font-bold text-white mb-3">üìù Notes</label>
                <textarea value={notes} onChange={(e) => setNotes(e.target.value)} rows={4}
                  className="w-full px-6 py-4 bg-white/90 rounded-xl text-gray-900 font-medium"
                  placeholder="How are you feeling? Any challenges or wins today?" />
              </div>

              <button onClick={handleSubmit}
                className="w-full py-5 bg-gradient-to-r from-green-500 via-emerald-500 to-teal-500 text-white font-extrabold text-xl rounded-2xl shadow-2xl">
                üíæ Save Check-In
              </button>
            </div>
          </div>
        </div>
      );
    };

    // Render app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<WeightLossApp />);
    
    // Initialize Lucide icons
    setTimeout(() => { if (window.lucide) lucide.createIcons(); }, 500);
  </script>
</body>
</html>
